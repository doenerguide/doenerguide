"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2316],{2316:(B,I,f)=>{f.r(I),f.d(I,{MapPage:()=>W});var m=f(467),p=f(4438),M=f(177),O=f(4341);function A(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}"function"==typeof SuppressedError&&SuppressedError;var R=A(function o(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var e,i,s;if(Array.isArray(t)){if((e=t.length)!=r.length)return!1;for(i=e;0!=i--;)if(!o(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((e=(s=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(i=e;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,s[i]))return!1;for(i=e;0!=i--;){var l=s[i];if(!o(t[l],r[l]))return!1}return!0}return t!=t&&r!=r});const L="__googleMapsScriptId";var g=function(o){return o[o.INITIALIZED=0]="INITIALIZED",o[o.LOADING=1]="LOADING",o[o.SUCCESS=2]="SUCCESS",o[o.FAILURE=3]="FAILURE",o}(g||{});class u{constructor({apiKey:t,authReferrerPolicy:r,channel:e,client:i,id:s=L,language:l,libraries:a=[],mapIds:n,nonce:c,region:h,retries:y=3,url:d="https://maps.googleapis.com/maps/api/js",version:v}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=t,this.authReferrerPolicy=r,this.channel=e,this.client=i,this.id=s||L,this.language=l,this.libraries=a,this.mapIds=n,this.nonce=c,this.region=h,this.retries=y,this.url=d,this.version=v,u.instance){if(!R(this.options,u.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(u.instance.options)}`);return u.instance}u.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?g.FAILURE:this.done?g.SUCCESS:this.loading?g.LOADING:g.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let t=this.url;return t+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(t+=`&key=${this.apiKey}`),this.channel&&(t+=`&channel=${this.channel}`),this.client&&(t+=`&client=${this.client}`),this.libraries.length>0&&(t+=`&libraries=${this.libraries.join(",")}`),this.language&&(t+=`&language=${this.language}`),this.region&&(t+=`&region=${this.region}`),this.version&&(t+=`&v=${this.version}`),this.mapIds&&(t+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(t+=`&auth_referrer_policy=${this.authReferrerPolicy}`),t}deleteScript(){const t=document.getElementById(this.id);t&&t.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((t,r)=>{this.loadCallback(e=>{e?r(e.error):t(window.google)})})}importLibrary(t){return this.execute(),google.maps.importLibrary(t)}loadCallback(t){this.callbacks.push(t),this.execute()}setScript(){var t,r;if(document.getElementById(this.id))return void this.callback();const e={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(e).forEach(s=>!e[s]&&delete e[s]),null!==(r=null===(t=null==window?void 0:window.google)||void 0===t?void 0:t.maps)&&void 0!==r&&r.importLibrary||(s=>{let l,a,n,c="The Google Maps JavaScript API",h="google",y="importLibrary",d="__ib__",v=document,T=window;T=T[h]||(T[h]={});const b=T.maps||(T.maps={}),C=new Set,w=new URLSearchParams,G=()=>l||(l=new Promise((S,k)=>function P(o,t,r,e){return new(r||(r=Promise))(function(s,l){function a(h){try{c(e.next(h))}catch(y){l(y)}}function n(h){try{c(e.throw(h))}catch(y){l(y)}}function c(h){h.done?s(h.value):function i(s){return s instanceof r?s:new r(function(l){l(s)})}(h.value).then(a,n)}c((e=e.apply(o,t||[])).next())})}(this,void 0,void 0,function*(){var E;for(n in yield a=v.createElement("script"),a.id=this.id,w.set("libraries",[...C]+""),s)w.set(n.replace(/[A-Z]/g,K=>"_"+K[0].toLowerCase()),s[n]);w.set("callback",h+".maps."+d),a.src=this.url+"?"+w,b[d]=S,a.onerror=()=>l=k(Error(c+" could not load.")),a.nonce=this.nonce||(null===(E=v.querySelector("script[nonce]"))||void 0===E?void 0:E.nonce)||"",v.head.append(a)})));b[y]?console.warn(c+" only loads once. Ignoring:",s):b[y]=(S,...k)=>C.add(S)&&G().then(()=>b[y](S,...k))})(e);const i=this.libraries.map(s=>this.importLibrary(s));i.length||i.push(this.importLibrary("core")),Promise.all(i).then(()=>this.callback(),s=>{const l=new ErrorEvent("error",{error:s});this.loadErrorCallback(l)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(t){if(this.errors.push(t),this.errors.length<=this.retries){const r=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${r} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},r)}else this.onerrorEvent=t,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(t=>{t(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version)return console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),void this.callback();this.loading||(this.loading=!0,this.setScript())}}}var U=f(5312),j=f(3018),F=f(9011),x=f(8880),N=f(7291);const $=["map"];let W=(()=>{var o;class t{constructor(e,i,s,l){this.locationSrv=e,this.databaseSrv=i,this.navCtrl=s,this.storageSrv=l,this.map=null,this.currentCircle=null,this.renderer=(0,p.WQX)(p.sFG),this.shownShops=[],this.currentDark=!1,this.mapsLoader=new u({apiKey:U.c.mapsApiKey,version:"weekly"}),this.set_circle=(a,n,c)=>new google.maps.Circle({strokeColor:"#1E7FF3",strokeOpacity:.8,strokeWeight:2,fillColor:"#1AADEB",fillOpacity:.1,map:a,center:n,radius:c})}ngOnInit(){var e=this;return(0,m.A)(function*(){try{let i=yield e.locationSrv.getUserLocation();e.locationSrv.lat=i.lat,e.locationSrv.long=i.long}catch(i){console.error(i)}e.location=new google.maps.LatLng(e.locationSrv.lat,e.locationSrv.long),e.loadMap()})()}ionViewWillEnter(){this.storageSrv.darkMode().then(e=>{e!=this.currentDark&&this.loadMap()}),this.location=new google.maps.LatLng(this.locationSrv.lat,this.locationSrv.long),this.setShops().then(()=>{this.currentCircle&&this.currentCircle.setMap(null),this.currentCircle=this.set_circle(this.map,this.location,1e3*this.locationSrv.radius);for(const e of this.shownShops)this.addMarker(new google.maps.LatLng(e.lat,e.lng),"<h2>"+e.name+"</h2><p>"+e.address+'</p><ion-button size="small" shop="'+e.id+'" class="moreInfo">Mehr Informationen <ion-icon name="arrow-forward-outline" slot="end" /> </ion-button>')})}change_radius(e){this.locationSrv.setRadius(e.detail.value),this.setShops()}setShops(){var e=this;return(0,m.A)(function*(){e.shownShops=yield e.databaseSrv.getShops(e.locationSrv.lat,e.locationSrv.long,e.locationSrv.radius)})()}loadMap(){var e=this;return(0,m.A)(function*(){const i=e.mapElementRef.nativeElement;e.mapsLoader.importLibrary("core").then((0,m.A)(function*(){const{Map:s}=yield e.mapsLoader.importLibrary("maps");let l=yield e.getMapsStyle();e.map=new s(i,{center:e.location,zoom:13.25-.085*e.locationSrv.radius,scaleControl:!1,streetViewControl:!1,zoomControl:!0,mapTypeControl:!1,fullscreenControl:!1,styles:l,disableDefaultUI:!0}),e.renderer.addClass(i,"visible")}))})()}addMarker(e,i){const s={url:"assets/logo.png",scaledSize:new google.maps.Size(50,50)},l=new google.maps.Marker({position:e,map:this.map,icon:s}),a=new google.maps.InfoWindow({content:`<div style="color: black !important;">${i}</div>`});a.addListener("domready",()=>{let n=document.getElementsByClassName("moreInfo");for(let c=0;c<n.length;c++)n[c].addEventListener("click",()=>{let h=n[c].getAttribute("shop"),y=this.shownShops.find(d=>d.id==h);this.navCtrl.navigateForward(["/shop",{shop:JSON.stringify(y)}])})}),l.addListener("click",()=>{a==this.infoWindow?(a.close(),this.infoWindow=null):(this.infoWindow&&(this.infoWindow.close(),this.infoWindow=null),a.open(this.map,l),this.infoWindow=a)}),l.addListener("dragend",n=>{l.setPosition(n.latLng),this.map.panTo(n.latLng)})}ngOnDestroy(){this.mapListener&&(google.maps.event.removeListener(this.mapListener),this.mapListener=null),this.markerListener&&(this.marker.removeEventListener("dragend",this.markerListener),this.markerListener=null)}getMapsStyle(){var e=this;return(0,m.A)(function*(){return(yield e.storageSrv.darkMode())?(e.currentDark=!0,[{featureType:"all",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#e5c163"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#c4c4c4"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#e5c163"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21},{visibility:"on"}]},{featureType:"poi.business",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#e5c163"},{lightness:"0"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#e5c163"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#575757"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.stroke",stylers:[{color:"#2c2c2c"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#999999"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"},{lightness:17}]}]):(e.currentDark=!1,[{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#f7f1df"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#d0e3b4"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"geometry",stylers:[{color:"#fbd3da"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#bde6ab"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffe15f"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efd151"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"black"}]},{featureType:"transit.station.airport",elementType:"geometry.fill",stylers:[{color:"#cfb2db"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#a2daf2"}]}])})()}}return(o=t).\u0275fac=function(e){return new(e||o)(p.rXU(j.N),p.rXU(F.B),p.rXU(x.q9),p.rXU(N.n))},o.\u0275cmp=p.VBU({type:o,selectors:[["app-map"]],viewQuery:function(e,i){if(1&e&&p.GBs($,7),2&e){let s;p.mGM(s=p.lsd())&&(i.mapElementRef=s.first)}},standalone:!0,features:[p.aNF],decls:2,vars:0,consts:[["map",""],[1,"map"]],template:function(e,i){1&e&&p.nrm(0,"div",1,0)},dependencies:[M.MD,O.YN],styles:[".map[_ngcontent-%COMP%]{height:100%;width:100%;background-color:transparent;opacity:0;transition:opacity .15s ease-in}.map.visible[_ngcontent-%COMP%]{opacity:1}"]}),t})()}}]);